# Title
Implement Subtasks Support

# Description
Extend `hod add` and `hod list` to support hierarchical subtasks.

## Context

- Task 5 (add) creates main tasks only: 1, 2, 3...
- Task 6 (list) shows all tasks in flat list
- Task 13 (Index) already handles dependencies for all task IDs
- ID format supports subtasks: `^\d+(\.\d+)*$` (1, 1.1, 1.2.3, etc.)

## Changes to Task 5 (hod add)

### Add `--parent` flag

```bash
hod add --title "Main task"           # Creates task 1
hod add --title "Subtask" --parent 1  # Creates task 1.1
hod add --title "Deep sub" --parent 1.1  # Creates task 1.1.1
```

### ID generation with parent

Algorithm:
```ts
// If --parent provided
if (parent) {
  // 1. Get all tasks with parent prefix
  const tasks = await storage.list();
  const siblings = tasks.filter(t => t.id.startsWith(parent + '.'));

  // 2. Extract subtask numbers
  const subNumbers = siblings
    .map(t => t.id.split('.').slice(1))  // ["1", "1"] from "1.1.1"
    .filter(parts => parts.length === 1)  // Only direct children
    .map(parts => Number(parts[0]));

  // 3. Find max, increment
  const max = subNumbers.length > 0 ? Math.max(...subNumbers) : 0;
  return `${parent}.${max + 1}`;
}
```

Examples:
- No siblings of 1 → creates `1.1`
- Tasks [1.1, 1.2] exist → creates `1.3`
- Parent 1.1 with [1.1.1, 1.1.2] → creates `1.1.3`

### Parent validation

- Parent must exist → `StorageNotFoundError` if not
- Parent ID format validation → same regex as task ID
- Parent can be any valid task (main or subtask)

### Error messages

```ts
// Parent not found
"Родительская задача '{parentId}' не существует"

// Invalid parent format
"Неверный формат ID родительской задачи: '{parentId}'"
```

## Changes to Task 6 (hod list)

### Add `--tree` flag

```bash
hod list --tree
```

Output:
```
1  pending    Main task
├──1.1  pending    Subtask 1
│  └──1.1.1  completed    Deep subtask
└──1.2  pending    Subtask 2
2  completed    Other task
```

### Tree format rules

- Indent with `│  ` for each level
- Use `├──` for non-last child
- Use `└──` for last child
- Root tasks (no dot) at column 0
- Sort by ID within each level

### Flat list remains default

```bash
hod list  # Still shows flat list
```

```
ID    Status     Title
1     pending    Main task
1.1   pending    Subtask 1
1.1.1 completed  Deep subtask
1.2   pending    Subtask 2
2     completed  Other task
```

## Integration

### Extended AddCommandOptions

```ts
export interface AddCommandOptions {
  [fieldName: string]: string | undefined;
  dependencies?: string;
  parent?: string;  // NEW: parent task ID
}
```

### Extended ListCommandOptions

```ts
export interface ListCommandOptions {
  [fieldName: string]: string | undefined;
  json?: boolean;
  tree?: boolean;  // NEW: tree view
}
```

### Dependencies validation

Subtasks can have their own dependencies:

```bash
hod add --title "Subtask" --parent 1 --dependencies 2,3
```

- Validated by Index.update() (circular, etc.)
- No restriction on dependency levels
- Subtask can depend on parent's dependencies, siblings, or other tasks

## Edge Cases

### ID generation

- Parent not found → error before ID generation
- Parent has many subtasks → find max correctly
- Deep nesting (1.1.1.1.1...) → no limit in v1
- Gaps in numbering [1.1, 1.5] → creates 1.6 (fills next)

### Tree display

- Orphaned subtask (parent deleted) → show at root level
- Deep nesting → indent appropriately
- Long task names → don't break tree structure
- Unicode characters → handle in tree drawing

### Validation

- Parent depends on child → Index catches circular dep
- Creating subtask with parent that doesn't exist → error
- `--parent 1` when task 1 doesn't exist → error

## Testing

### Unit Tests

- ID generation with parent (empty, existing, gaps)
- Parent validation (exists, invalid format)
- Tree structure calculation

### Integration Tests

- Create subtask under main task
- Create nested subtasks
- Dependencies with subtasks
- Tree view output
- Orphaned subtasks in tree

## DependsOn
5, 6

# Priority
high
