# Title
CLI команда `hod next`

# Description
Реализовать команду для вывода задач, готовых к выполнению.

## Usage

```bash
hod next              # показать следующие задачи
hod next --all        # показать все задачи с их статусами
```

## Логика работы

Команда читает **только index.json** (источник истины для статуса и зависимостей).

### next (без флагов)

Выводит задачи готовые к выполнению:
1. Статус `!== 'completed'`
2. Все зависимости выполнены (их статус `=== 'completed'`)

### --all

Выводит все задачи с их статусами и зависимостями (tree-like формат).

## Формат вывода

```
Следующие задачи:

  → 1.2 [pending]    Подзадача 1.2
     Зависит: 1.1 [completed]

  → 2   [pending]    Конфигурация
     Зависит: 1 [completed]

─────────────────────

  ✓ 1   [completed] Инициализация проекта
  ✓ 1.1 [completed] Подзадача 1.1
```

**Правила:**
- `→` — готова к выполнению
- `✓` — завершена (completed)
- Сортировка по ID
- Пустой список → "Нет задач"

### --all формат

```
Все задачи:

  → 1.2 [pending]    Подзадача 1.2
     Зависит: 1.1 [completed]

  → 2   [pending]    Конфигурация
     Зависит: 1 [completed]

  ✓ 1   [completed] Инициализация проекта

  ✓ 1.1 [completed] Подзадача 1.1

  ✗ 3   [blocked]    Тестирование
     Зависит: 2 [pending]  ← блокировка
```

**Правила:**
- `✗` — заблокирована (есть невыполненные зависимости)
- Показывать зависимости с их статусами
- Сортировка по ID

## Интеграция

### IndexService

Использует `index.getNextTasks()` для получения готовых задач:

```ts
// index.getNextTasks() уже возвращает отсортированные ID
const nextTaskIds = await index.getNextTasks();
```

Для `--all` — загружаем весь index и форматируем.

### Загрузка данных

```ts
// Загрузить индекс
const indexData = await index.load();

// Для --all: сформировать дерево зависимостей
for (const [id, data] of Object.entries(indexData)) {
  const isCompleted = data.status === 'completed';
  const depsStatus = data.dependencies.map(depId => {
    const dep = indexData[depId];
    return dep ? `${depId} [${dep.status}]` : `${depId} [missing]`;
  });
  // ... форматирование
}
```

## Обработка ошибок

```ts
// Index errors
if (error instanceof IndexLoadError) {
  console.error(`Ошибка загрузки индекса: ${error.message}`);
  process.exit(1);
}

if (error instanceof IndexCorruptionError) {
  console.error(`Индекс повреждён: ${error.message}`);
  console.error('Данные о статусах и зависимостях потеряны. Восстановление невозможно.');
  console.error('Рекомендуется регулярно бэкапить директорию tasks/.hod/');
  process.exit(1);
}
```

## CLI Framework

- **commander.js** для парсинга аргументов
- Использовать `createServices()` factory

```ts
export interface NextCommandOptions {
  all?: boolean;
}

export async function nextCommand(
  options: NextCommandOptions,
  services: Services,
): Promise<void> {
  // Implementation
}
```

## Код структуры

```
src/cli/
├── commands/
│   ├── next.ts          # Task 12 implementation
│   └── next.test.ts     # Tests
├── services.ts          # createServices() factory
└── index.ts             # Main CLI entry point (future task)
```

## Тестирование

### Unit Tests

- `getNextTasks()` — пустой индекс, готовые задачи, заблокированные
- Форматирование вывода для `--next`
- Форматирование вывода для `--all`
- Обработка orphaned dependencies

### Integration Tests

- Индекс с готовыми задачами
- Индекс с completed задачами
- Индекс с заблокированными задачами
- Пустой индекс
- IndexCorruptionError handling

## Edge Cases

| Сценарий | Поведение |
|----------|-----------|
| Пустой индекс | "Нет задач" |
| Все задачи completed | Пустой список (нет готовых) |
| Задача зависит от missing | Заблокирована, показать `[missing]` |
| Цикл в зависимостях | Невозможен (update() ловит) |
| Index не существует | IndexLoadError |
| Index повреждён | IndexCorruptionError с data loss warning |

## DependsOn
13

# Priority
high
