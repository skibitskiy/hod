# Title
Реализация парсера Markdown задач

# Description
Создать парсер для чтения/записи задач в Markdown формате.

## ParserService

```ts
interface ParsedTask {
  title: string;
  description?: string;
  status: string;
  dependencies: string[];  // всегда есть, минимум []
  [key: string]: string | string[] | undefined;
}
```

**Примечание:** Только `dependencies` является массивом (`string[]`). Все кастомные поля — строки.

```ts
interface ParserService {
  parse(markdown: string): ParsedTask;
  serialize(task: ParsedTask): string;
}
```

**Примечание:** ID задачи определяется именем файла (`1.md`, `1.1.md`), не содержимым markdown. Caller добавляет `id` после парсинга.

## Формат Markdown

```markdown
# Title
Название задачи

# Description
Описание задачи

# Status
pending

# Dependencies
1, 2, 5
```

## Обработка ошибок

```ts
class ParseError extends Error {
  constructor(message: string, public section?: string) {
    super(message);
    this.name = 'ParseError';
  }
}
```

### Формат сообщений

```ts
"Empty input" / section: undefined
"Missing required section: Title" / section: "Title"
"Invalid dependency ID: 'abc'" / section: "Dependencies"
```

- Пустой ввод → `ParseError("Empty input")`
- Отсутствие Title → `ParseError("Missing required section: Title", "Title")`
- Невалидный ID в Dependencies → `ParseError("Invalid dependency ID: 'abc'", "Dependencies")`

## Парсинг секций

### Общие правила

- Любой `# ` начинает новую секцию (включая кастомные поля)
- Ключи секций **case-sensitive** (`# Title` ≠ `# title`)
- Новая секция начинается только с `# Key` на отдельной строке
- Символ `#` в значении считается началом новой секции (экранирование не поддерживается в v1)
- Пустые строки между секциями игнорируются
- Пустые строки **внутри значения** сохраняются (до следующей секции)
- Значение trim'ится (пробелы в начале/конце удаляются)
- Многострочные значения поддерживаются
- Пустой ввод (пустая строка или только пробелы) → `ParseError`
- Минифицированный input без пустых строк работает корректно
- Отсутствие `\n` в конце файла — корректно

### Детекция секций

```markdown
# Title
Task

строка1

строка2

# Status
done
```

Пустые строки `строка1` и `строка2` — часть значения Title. `# Status` начинает новую секцию.

### Обязательные секции

- `# Title` — обязательно

### Опциональные секции

- `# Description` — может отсутствовать
- `# Status` — если отсутствует, используется `"pending"`
- `# Dependencies` — если отсутствует, используется `[]`

### Dependencies

- Формат: строка с ID через запятую: `1, 2, 5`
- Парсится как массив строк: `['1', '2', '5']`
- Каждый ID trim'ится: `"1,  2 , 3"` → `['1', '2', '3']`
- Пустые элементы фильтруются: `"1, , 3"` → `['1', '3']`
- Каждый ID валидируется regex: `^\d+(\.\d+)*$`
- Пустое значение → `[]`
- Если невалидный ID → `ParseError`

### Кастомные поля

- Все дополнительные секции парсятся как строки
- Ключ секции = ключ в объекте
- Значение = строка
- Типизация: только `Dependencies` = `string[]`, остальные = `string`

### Whitespace-only значения

Если после trim значение пустое → секция считается отсутствующей.

### Дубликаты секций

- Первое вхождение используется (по точному совпадению ключа, case-sensitive)
- Последующие игнорируются
- Единообразно для всех полей (стандартных и кастомных)

## Сериализация

```ts
serialize(task: ParsedTask): string
```

### Правила

- Секции выводятся в фиксированном порядке:
  1. Title
  2. Description (если не пустой)
  3. Status
  4. Dependencies
  5. Кастомные поля в алфавитном порядке
- Каждая секция: `# Key\nзначение`
- Пустая строка между секциями
- `# Dependencies` всегда присутствует (пустой если `[]` → `# Dependencies\n`)
- Пустые поля (кроме Dependencies) пропускаются
- `undefined` и `null` значения пропускаются
- Dependencies сериализуются через запятую: `1, 2, 5`
- Пустые элементы в Dependencies фильтруются

### Пример

```ts
{
  title: "Task",
  description: "Desc",
  status: "done",
  dependencies: ["1", "2"],
  priority: "high",
  tags: undefined
}
```

```markdown
# Title
Task

# Description
Desc

# Status
done

# Dependencies
1, 2

# Priority
high
```

## Валидация

### Dependencies

Каждый ID валидируется:
- Regex: `^\d+(\.\d+)*$`
- Если невалидный ID → `ParseError`

### Title

- Обязательная секция
- Если отсутствует → `ParseError`

### Status

- Любая строка валидна (нет enum)

## Дефолтные значения

- `status`: `"pending"` если секция отсутствует
- `dependencies`: `[]` если секция отсутствует

# DependsOn
3

# Priority
high
