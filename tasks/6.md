# Title
Создание CLI команды `hod list`

# Description
Реализовать команду вывода списка задач с фильтрацией и форматированием.

## Usage

```bash
hod list
hod list --status pending
hod list --status completed --json
hod list --json
```

## Requirements

### CLI Framework

- **commander.js** для парсинга аргументов (как в task 5)
- Использовать `createServices()` factory из `src/cli/services.ts`

### Аргументы

Динамические фильтры из `config.fields`:
- `--field-name value` — фильтр по equality
- Пример: `--status pending`, `--priority high`

**Специальные аргументы:**
- `--json` — вывод в JSON формате (вместо таблицы)

### Логика фильтрации

```ts
// 1. Загрузить все задачи из Storage
const tasks = await storage.list();

// 2. Распарсить каждую задачу
const parsed = tasks.map(t => parser.parse(t.content));

// 3. Применить фильтры из CLI аргументов
const filtered = parsed.filter(task => {
  for (const [key, value] of Object.entries(filters)) {
    if (task[key] !== value) return false;
  }
  return true;
});
```

### Вывод в таблицу

Формат для stdout (по умолчанию):
```
ID  Status     Title
1   pending    Название задачи
2   completed  Другая задача
```

Правила:
- ID — левая колонка, фиксированная ширина ~4 символа
- Остальные колонки — динамическая ширина, отсортированы по ключам config.fields
- Подзадачи (1.1, 1.2) — включаются в общий список
- Пустые задачи — не выводятся

**Пустой результат:**
```
Нет задач
```

### Вывод в JSON

Формат при `--json`:
```json
[
  {
    "id": "1",
    "title": "Название",
    "description": "Описание",
    "status": "pending",
    "dependencies": []
  },
  {
    "id": "2",
    "title": "Другая",
    "status": "completed",
    "dependencies": ["1"]
  }
]
```

- Все поля из config + `id` + `dependencies`
- Пустой результат → `[]`
- Использовать `console.log(JSON.stringify(result, null, 2))`

### Фильтрация по полям

- Фильтр применяется к parsed task (после parser)
- Строгое равенство (string comparison)
- Несколько фильтров → AND логика
- Неизвестные поля → ошибка (как в task 5)

Пример:
```bash
hod list --status pending --priority high
# → задачи где status === "pending" AND priority === "high"
```

### Обработка ошибок

Все ошибки используют **русские сообщения**:

```ts
// Unknown field
"Неизвестное поле '{fieldName}'. Доступные поля: {availableFields}"

// Parse errors (пропустить задачу с warning в stderr)
console.error(`Предупреждение: задача ${task.id} имеет ошибки парсинга и пропущена`);

// Storage errors (пробрасывать)
StorageAccessError → exit 1
```

### Service Factory

Использовать тот же `createServices()` из task 5:

```ts
// src/cli/services.ts
export interface Services {
  config: ConfigService;
  storage: StorageService;
  parser: ParserService;
  index: IndexService;  // не используется в list
}
```

## Code Structure

```
src/cli/
├── commands/
│   ├── add.ts           # Task 5 implementation
│   ├── list.ts          # Task 6 implementation
│   ├── add.test.ts
│   └── list.test.ts
├── services.ts          # createServices() factory (task 5)
└── index.ts             # Main CLI entry point (future task)
```

### Export Format

```ts
export interface ListCommandOptions {
  [fieldName: string]: string | undefined;  // Dynamic filters from config
  json?: boolean;  // Special flag
}

export async function listCommand(
  options: ListCommandOptions,
  services: Services,
): Promise<void> {
  // Implementation
}
```

## Testing

### Unit Tests (mocked services)

- Фильтрация по одному полю
- Фильтрация по нескольким полям (AND)
- Пустой результат
- JSON формат вывода
- Табличный формат вывода

### Integration Tests (real services, memfs)

- Загрузка и парсинг всех задач
- Фильтрация с custom полями из config
- Обработка задач с ошибками парсинга
- JSON валидность

## Edge Cases

### Фильтрация

- Пустые фильтры → показать все задачи
- Фильтр по несуществующему значению → пустой результат
- Подзадачи учитываются в общем списке
- Поле отсутствует у задачи → задача не проходит фильтр

### Парсинг

- Задача с невалидным markdown → warning в stderr, пропустить задачу
- Частично валидная задача → использовать что удалось распарсить
- Пустой файл → warning, пропустить

### Вывод

- Длинные значения → обрезать или переносить (на усмотрение)
- Спецсимволы в JSON → экранировать автоматически
- Unicode → поддерживать (UTF-8)

## Exit Codes

- **0:** Success (включая пустой результат)
- **1:** Error (сообщение в stderr)

## DependsOn
4, 13

# Priority
medium
