# Title
Создание CLI команд `hod update`, `hod delete` и `hod move`

# Description
Реализовать команды для изменения, удаления и перемещения задач.

## Команда `hod update`

Обновляет поля существующей задачи. Принимает ID задачи как позиционный аргумент и набор опций для изменения полей.

### Аргументы

- `<id>` — ID задачи для обновления (обязательный позиционный аргумент)
- `--field-name "value"` — опции для обновления полей из конфигурации (динамические)
- `--dependencies "ids"` — зависимости через запятую

### Логика работы

1. Валидировать формат ID с помощью regex из модуля валидации
2. Проверить существование задачи через `storage.exists()` — если нет, выбросить `StorageNotFoundError`
3. Прочитать текущее содержимое через `storage.read()`
4. Распарсить через `parser.parse()` для получения текущего `ParsedTask`
5. Валидировать имена полей из опций (fail-fast, как в `list.ts`)
6. Собрать новые значения полей из опций (переиспользовать `collectFields` из `add.ts`)
7. Распарсить зависимости из опции `--dependencies` (переиспользовать `parseDependencies` из `add.ts`)
8. Собрать обновлённый `ParsedTask`: объединить текущие значения с новыми (новые перекрывают старые)
9. Проверить зависимости на цикличность через `index.update()` — если есть цикл, ошибка без записи в storage
10. Сериализовать через `parser.serialize()`
11. Записать через `storage.update()` (atomic)
12. Вывести сообщение об успехе

### Правила обновления полей

- Указанные поля заменяют текущие значения
- Неуказанные поля остаются без изменений
- Пустая строка для опционального поля (например, `--description ""`) удаляет это поле из markdown
- При обновлении dependencies — полная замена массива, не мерж

### Обработка ошибок

- Невалидный ID → Error с описанием формата
- Несуществующий ID → `StorageNotFoundError`
- Неизвестное поле → Error со списком доступных полей
- Циклическая зависимость → `CircularDependencyError` из index
- Ошибка записи storage → fatal error

---

## Команда `hod delete`

Удаляет задачу по ID.

### Аргументы

- `<id>` — ID задачи для удаления (обязательный позиционный аргумент)
- `-r, --recursive` — флаг для рекурсивного удаления задачи со всеми подзадачами

### Логика работы

1. Валидировать формат ID
2. Проверить существование задачи через `storage.exists()` — если нет, ошибка
3. Проверить наличие подзадач через `storage.list()` — найти все задачи, ID которых начинается с `{id}.`
4. Если есть подзадачи и флаг `-r` не указан:
   - Вывести ошибку с сообщением о наличии подзадач
   - Вывести список подзадач
   - Exit с кодом 1
5. Если есть подзадачи и флаг `-r` указан:
   - Собрать все подзадачи рекурсивно (глубокий поиск: `1.1`, `1.1.1`, `1.2`, etc.)
   - Удалить в порядке от листьев к корню (сначала самые глубокие)
   - Удалить каждую подзадачу из storage и index
6. Удалить саму задачу через `storage.delete()`
7. Удалить задачу из индекса через `index.remove()`
8. Вывести сообщение об успехе

### Поведение при наличии подзадач

- Без флага `-r`: ошибка, удаление запрещено
- С флагом `-r`: cascade delete, удаляются все подзадачи рекурсивно
- Порядок удаления: от самых глубоких к корню (например, `1.1.1`, `1.1`, `1`)

### Обработка orphaned зависимостей

- Если другие задачи зависят от удалённой, оставлять как есть
- Orphaned references допустимы в v1
- Команда `hod sync` (future) сможет очистить такие ссылки

---

## Команда `hod move`

Перемещает задачу под нового родителя. Создаёт новую задачу с теми же полями под новым родителем и удаляет старую.

### Аргументы

- `<id>` — ID задачи для перемещения (обязательный позиционный аргумент)
- `--parent <id>` — ID нового родителя (опционально, если не указан — задача становится главной)

### Логика работы

1. Валидировать формат перемещаемой задачи
2. Валидировать формат нового родителя (если указан)
3. Проверить существование перемещаемой задачи
4. Проверить существование нового родителя (если указан)
5. Проверить что новый родитель — главная задача (не подзадача)
6. Проверить наличие подзадач у перемещаемой задачи:
   - Если есть подзадачи — ошибка, перемещение запрещено
7. Прочитать и распарсить текущую задачу
8. Сгенерировать новый ID под новым родителем (или как главную задачу)
9. Проверить зависимости на цикличность с учётом нового ID
10. Создать новую задачу с новым ID через `storage.create()`
11. Обновить индекс через `index.update()` (с rollback при ошибке)
12. Удалить старую задачу через `storage.delete()`
13. Удалить старую задачу из индекса через `index.remove()`
14. Вывести сообщение об успехе с новым ID

### Ограничения

- Нельзя переместить задачу если у неё есть подзадачи
- Нельзя сделать подзадачу родителем (только главные задачи)
- Зависимости сохраняются без изменений
- Все поля задачи копируются без изменений

### Обработка ошибок

- Если создание новой задачи не удалось — rollback (не удалять старую)
- Если обновление индекса не удалось — rollback (удалить новую задачу)

---

## Общие требования

### Структура файлов

```
src/cli/commands/
├── update.ts           # реализация команды update
├── delete.ts           # реализация команды delete
├── move.ts             # реализация команды move
├── update.test.ts      # тесты
├── delete.test.ts      # тесты
└── move.test.ts        # тесты
```

### Регистрация команд

Добавить в `src/cli/index.ts` функции `registerUpdateCommand()`, `registerDeleteCommand()` и `registerMoveCommand()` по аналогии с существующими `registerAddCommand()` и `registerListCommand()`.

Использовать `registerConfigOptions()` для динамических опций из конфигурации.

### Переиспользование кода

Из `add.ts` можно переиспользовать:
- `collectFields` — сбор значений полей из опций
- `validateFieldNames` — валидация имён полей
- `validateParent` — валидация родительской задачи
- `parseDependencies` — парсинг зависимостей из строки
- `fieldsToParsedTask` — конвертация полей в ParsedTask
- `generateMainTaskId` — генерация ID главной задачи
- `generateSubtaskId` — генерация ID подзадачи

### Сообщения об ошибках

Все сообщения на русском языке, следовать стилю существующих команд.

### Тестирование

Integration-First подход с memfs для мокания файловой системы. Все сервисы — реальные инстансы.

Тест-кейсы для update:
- Обновление одного поля
- Обновление нескольких полей одновременно
- Обновление dependencies с проверкой на циклы
- Невалидный/несуществующий ID
- Неизвестное поле

Тест-кейсы для delete:
- Удаление существующей задачи без подзадач
- Попытка удаления с подзадачами без `-r` — ошибка со списком
- Удаление с подзадачами с флагом `-r` — cascade delete
- Удаление глубокой иерархии с `-r` (1, 1.1, 1.1.1, 1.2)
- Невалидный/несуществующий ID

Тест-кейсы для move:
- Перемещение подзадачи в главные задачи (1.1 -> 2)
- Перемещение главной задачи под другую (1 -> 2, получится 2.1)
- Попытка перемещения с подзадачами — ошибка
- Перемещение задачи в несуществующего родителя — ошибка
- Подзадача как новый родитель — ошибка
- Rollback при ошибке создания новой задачи

---

## DependsOn
task-6, task-13

# Priority
medium
